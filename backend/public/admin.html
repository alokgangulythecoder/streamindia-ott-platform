<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassicFlims - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #6366f1; --primary-dark: #4f46e5;
            --success: #10b981; --danger: #ef4444;
            --warning: #f59e0b; --info: #3b82f6;
            --dark: #1f2937; --dark-light: #374151;
            --gray: #6b7280; --gray-light: #e5e7eb;
            --sidebar-width: 260px;
        }
        body { font-family: 'Inter', sans-serif; background: #f3f4f6; color: var(--dark); }

        /* LOGIN */
        .login-container { min-height:100vh; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,var(--primary),var(--primary-dark)); }
        .login-box { background:white; padding:3rem; border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,0.3); width:100%; max-width:420px; }
        .login-box h1 { font-size:2rem; margin-bottom:0.5rem; }
        .login-box p { color:var(--gray); margin-bottom:2rem; }

        /* LAYOUT */
        .admin-container { display:none; }
        .admin-container.active { display:flex; min-height:100vh; }
        .sidebar { width:var(--sidebar-width); background:var(--dark); color:white; position:fixed; top:0; left:0; height:100vh; overflow-y:auto; z-index:1000; }
        .sidebar-header { padding:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); }
        .sidebar-header h2 { font-size:1.5rem; background:linear-gradient(135deg,#fff,#a5b4fc); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .sidebar-menu { padding:1rem 0; }
        .menu-item { padding:0.75rem 1.5rem; display:flex; align-items:center; gap:0.75rem; color:rgba(255,255,255,0.7); cursor:pointer; transition:all 0.3s; text-decoration:none; border-left:4px solid transparent; }
        .menu-item:hover, .menu-item.active { background:rgba(99,102,241,0.2); color:white; border-left-color:var(--primary); }
        .main-content { margin-left:var(--sidebar-width); flex:1; padding:2rem; min-height:100vh; }
        .topbar { background:white; padding:1rem 2rem; border-radius:12px; margin-bottom:2rem; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 8px rgba(0,0,0,0.05); }
        .topbar h1 { font-size:1.75rem; }
        .user-info { display:flex; align-items:center; gap:1rem; }
        .user-avatar { width:40px; height:40px; border-radius:50%; background:var(--primary); display:flex; align-items:center; justify-content:center; color:white; font-weight:700; }

        /* STATS */
        .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1.5rem; margin-bottom:2rem; }
        .stat-card { background:white; padding:1.5rem; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.05); }
        .stat-card-header { display:flex; justify-content:space-between; align-items:center; }
        .stat-card-icon { width:50px; height:50px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.5rem; }
        .stat-card-icon.primary { background:rgba(99,102,241,0.1); }
        .stat-card-icon.success { background:rgba(16,185,129,0.1); }
        .stat-card-icon.warning { background:rgba(245,158,11,0.1); }
        .stat-card-icon.danger { background:rgba(239,68,68,0.1); }
        .stat-card h3 { font-size:2rem; margin-bottom:0.25rem; }
        .stat-card p { color:var(--gray); font-size:0.9rem; }

        /* SECTIONS */
        .content-section { display:none; }
        .content-section.active { display:block; }
        .card { background:white; border-radius:12px; padding:1.5rem; box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-bottom:1.5rem; }
        .card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; }
        .card-header h2 { font-size:1.25rem; }

        /* TABLE */
        .table-container { overflow-x:auto; }
        table { width:100%; border-collapse:collapse; }
        th, td { padding:0.875rem 1rem; text-align:left; border-bottom:1px solid var(--gray-light); }
        th { font-weight:600; background:#f9fafb; }
        tr:hover td { background:#f9fafb; }

        /* BADGES */
        .badge { display:inline-block; padding:0.25rem 0.75rem; border-radius:20px; font-size:0.75rem; font-weight:600; text-transform:uppercase; }
        .badge-success { background:rgba(16,185,129,0.1); color:var(--success); }
        .badge-warning { background:rgba(245,158,11,0.1); color:var(--warning); }
        .badge-danger { background:rgba(239,68,68,0.1); color:var(--danger); }
        .badge-info { background:rgba(59,130,246,0.1); color:var(--info); }

        /* BUTTONS */
        .btn { padding:0.75rem 1.5rem; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:all 0.3s; font-size:0.95rem; }
        .btn-primary { background:var(--primary); color:white; }
        .btn-primary:hover { background:var(--primary-dark); }
        .btn-success { background:var(--success); color:white; }
        .btn-danger { background:var(--danger); color:white; }
        .btn-warning { background:var(--warning); color:white; }
        .btn-secondary { background:var(--gray); color:white; }
        .btn-sm { padding:0.4rem 0.85rem; font-size:0.8rem; }

        /* FORMS */
        .form-group { margin-bottom:1.25rem; }
        .form-group label { display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.875rem; }
        .form-control { width:100%; padding:0.75rem 1rem; border:2px solid var(--gray-light); border-radius:8px; font-size:0.95rem; font-family:inherit; transition:border-color 0.2s; }
        .form-control:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(99,102,241,0.1); }
        textarea.form-control { min-height:100px; resize:vertical; }
        .form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:1rem; }
        .form-group-full { grid-column:1/-1; }

        /* MODAL */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.55); z-index:2000; align-items:center; justify-content:center; }
        .modal.active { display:flex; }
        .modal-content { background:white; border-radius:12px; padding:2rem; width:90%; max-width:640px; max-height:90vh; overflow-y:auto; }
        .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; padding-bottom:1rem; border-bottom:2px solid var(--gray-light); }
        .modal-header h2 { font-size:1.4rem; }
        .close-modal { background:none; border:none; font-size:1.75rem; cursor:pointer; color:var(--gray); line-height:1; }
        .close-modal:hover { color:var(--dark); }

        /* ALERT */
        .alert { padding:0.875rem 1rem; border-radius:8px; margin-bottom:1rem; font-size:0.9rem; }
        .alert-success { background:rgba(16,185,129,0.1); color:var(--success); border-left:4px solid var(--success); }
        .alert-danger { background:rgba(239,68,68,0.1); color:var(--danger); border-left:4px solid var(--danger); }

        /* TOAST */
        .toast { position:fixed; bottom:2rem; right:2rem; padding:1rem 1.5rem; border-radius:10px; color:white; font-weight:600; z-index:9999; animation:slideUp 0.3s ease; }
        .toast-success { background:var(--success); }
        .toast-error { background:var(--danger); }
        @keyframes slideUp { from { transform:translateY(60px); opacity:0; } to { transform:translateY(0); opacity:1; } }

        /* LOADING */
        .loading { text-align:center; padding:2rem; color:var(--gray); }
        .spinner { border:4px solid var(--gray-light); border-top:4px solid var(--primary); border-radius:50%; width:36px; height:36px; animation:spin 0.8s linear infinite; margin:0 auto; }
        @keyframes spin { to { transform:rotate(360deg); } }

        /* EMPTY STATE */
        .empty-state { text-align:center; padding:3rem; color:var(--gray); }
        .empty-state p { font-size:1rem; margin-top:0.5rem; }

        @media(max-width:768px) {
            .sidebar { transform:translateX(-100%); }
            .main-content { margin-left:0; padding:1rem; }
            .stats-grid { grid-template-columns:1fr 1fr; }
        }
    </style>
</head>
<body>

<!-- ========== LOGIN PAGE ========== -->
<div id="loginPage" class="login-container">
    <div class="login-box">
        <h1>Welcome Back</h1>
        <p>Sign in to ClassicFlims Admin Panel</p>
        <div id="loginAlert" style="display:none;"></div>
        <form id="loginForm">
            <div class="form-group">
                <label>Username</label>
                <input type="text" class="form-control" id="loginUsername" required autocomplete="username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" class="form-control" id="loginPassword" required autocomplete="current-password">
            </div>
            <button type="submit" class="btn btn-primary" style="width:100%;">Sign In</button>
        </form>
        <p style="margin-top:1.5rem;font-size:0.875rem;color:var(--gray);">Default: admin / admin123</p>
    </div>
</div>

<!-- ========== ADMIN DASHBOARD ========== -->
<div id="adminPanel" class="admin-container">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header"><h2>ClassicFlims</h2></div>
        <nav class="sidebar-menu">
            <a href="#" class="menu-item active" data-section="dashboard"><span>üìä</span><span>Dashboard</span></a>
            <a href="#" class="menu-item" data-section="content"><span>üé¨</span><span>Content</span></a>
            <a href="#" class="menu-item" data-section="navigation"><span>üß≠</span><span>Navigation</span></a>
            <a href="#" class="menu-item" data-section="advertisements"><span>üì¢</span><span>Advertisements</span></a>
            <a href="#" class="menu-item" data-section="settings"><span>‚öôÔ∏è</span><span>Settings</span></a>
            <a href="#" class="menu-item" id="logoutBtn"><span>üö™</span><span>Logout</span></a>
        </nav>
    </aside>

    <!-- Main -->
    <main class="main-content">
        <div class="topbar">
            <h1 id="pageTitle">Dashboard</h1>
            <div class="user-info">
                <span id="adminUsername"></span>
                <div class="user-avatar" id="adminAvatar">A</div>
            </div>
        </div>

        <!-- Dashboard -->
        <section id="dashboardSection" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div><h3 id="totalContent">0</h3><p>Total Content</p></div>
                        <div class="stat-card-icon primary">üé¨</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div><h3 id="publishedContent">0</h3><p>Published</p></div>
                        <div class="stat-card-icon success">‚úì</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div><h3 id="totalViews">0</h3><p>Total Views</p></div>
                        <div class="stat-card-icon warning">üëÅÔ∏è</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div><h3 id="totalAds">0</h3><p>Active Ads</p></div>
                        <div class="stat-card-icon danger">üì¢</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h2>Recent Content</h2></div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Title</th><th>Type</th><th>Views</th><th>Created</th></tr></thead>
                        <tbody id="recentContentTable"><tr><td colspan="4"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Content Section -->
        <section id="contentSection" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2>Content Management</h2>
                    <button class="btn btn-primary btn-sm" onclick="openContentModal()">+ Add Content</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Title</th><th>Type</th><th>Category</th><th>Status</th><th>Views</th><th>Actions</th></tr></thead>
                        <tbody id="contentTable"><tr><td colspan="6"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Navigation Section -->
        <section id="navigationSection" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2>Navigation Menu</h2>
                    <button class="btn btn-primary btn-sm" onclick="openNavModal()">+ Add Menu Item</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Label</th><th>URL</th><th>Icon</th><th>Order</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody id="navigationTable"><tr><td colspan="6"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Advertisements Section -->
        <section id="advertisementsSection" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2>Advertisements</h2>
                    <button class="btn btn-primary btn-sm" onclick="openAdModal()">+ Add Advertisement</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Title</th><th>Type</th><th>Position</th><th>Priority</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody id="adsTable"><tr><td colspan="6"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settingsSection" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2>Settings</h2>
                    <button class="btn btn-primary btn-sm" onclick="openSettingModal()">+ Add Setting</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Key</th><th>Value</th><th>Category</th><th>Actions</th></tr></thead>
                        <tbody id="settingsTable"><tr><td colspan="4"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>
</div>

<!-- ========== CONTENT MODAL ========== -->
<div id="contentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="contentModalTitle">Add Content</h2>
            <button class="close-modal" onclick="closeContentModal()">‚úï</button>
        </div>
        <form id="contentForm">
            <input type="hidden" id="contentId">
            <div class="form-grid">
                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" class="form-control" id="contentTitle" required>
                </div>
                <div class="form-group">
                    <label>Type *</label>
                    <select class="form-control" id="contentType" required>
                        <option value="movie">Movie</option>
                        <option value="series">Series</option>
                        <option value="documentary">Documentary</option>
                        <option value="live">Live</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" class="form-control" id="contentCategory" placeholder="e.g. Film Noir">
                </div>
                <div class="form-group">
                    <label>Language</label>
                    <input type="text" class="form-control" id="contentLanguage" placeholder="English">
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input type="number" class="form-control" id="contentYear" placeholder="1942">
                </div>
                <div class="form-group">
                    <label>Rating (0-10)</label>
                    <input type="number" step="0.1" min="0" max="10" class="form-control" id="contentRating" placeholder="8.5">
                </div>
                <div class="form-group form-group-full">
                    <label>Description</label>
                    <textarea class="form-control" id="contentDescription"></textarea>
                </div>
                <div class="form-group form-group-full">
                    <label>Video URL *</label>
                    <input type="url" class="form-control" id="contentVideoUrl" required placeholder="https://youtube.com/...">
                </div>
                <div class="form-group form-group-full">
                    <label>Thumbnail URL</label>
                    <input type="url" class="form-control" id="contentThumbnail" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="contentStatus">
                        <option value="published">Published</option>
                        <option value="draft">Draft</option>
                        <option value="archived">Archived</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Featured</label>
                    <select class="form-control" id="contentFeatured">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
            </div>
            <div style="display:flex;gap:1rem;margin-top:1.5rem;">
                <button type="submit" class="btn btn-primary">Save Content</button>
                <button type="button" class="btn btn-secondary" onclick="closeContentModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- ========== NAVIGATION MODAL ========== -->
<div id="navModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="navModalTitle">Add Menu Item</h2>
            <button class="close-modal" onclick="closeNavModal()">‚úï</button>
        </div>
        <form id="navForm">
            <input type="hidden" id="navId">
            <div class="form-grid">
                <div class="form-group">
                    <label>Label *</label>
                    <input type="text" class="form-control" id="navLabel" placeholder="e.g. Home" required>
                </div>
                <div class="form-group">
                    <label>URL *</label>
                    <input type="text" class="form-control" id="navUrl" placeholder="e.g. /" required>
                </div>
                <div class="form-group">
                    <label>Icon (Emoji)</label>
                    <input type="text" class="form-control" id="navIcon" placeholder="üè†">
                </div>
                <div class="form-group">
                    <label>Order</label>
                    <input type="number" class="form-control" id="navOrder" value="0" min="0">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="navActive">
                        <option value="true">Active</option>
                        <option value="false">Inactive</option>
                    </select>
                </div>
            </div>
            <div style="display:flex;gap:1rem;margin-top:1.5rem;">
                <button type="submit" class="btn btn-primary">Save Item</button>
                <button type="button" class="btn btn-secondary" onclick="closeNavModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- ========== ADVERTISEMENT MODAL ========== -->
<div id="adModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="adModalTitle">Add Advertisement</h2>
            <button class="close-modal" onclick="closeAdModal()">‚úï</button>
        </div>
        <form id="adForm">
            <input type="hidden" id="adId">
            <div class="form-grid">
                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" class="form-control" id="adTitle" required>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select class="form-control" id="adType">
                        <option value="banner">Banner</option>
                        <option value="video">Video</option>
                        <option value="popup">Popup</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Position</label>
                    <select class="form-control" id="adPosition">
                        <option value="header">Header</option>
                        <option value="sidebar">Sidebar</option>
                        <option value="footer">Footer</option>
                        <option value="player">Player</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority (0-10)</label>
                    <input type="number" class="form-control" id="adPriority" value="5" min="0" max="10">
                </div>
                <div class="form-group form-group-full">
                    <label>Image URL *</label>
                    <input type="url" class="form-control" id="adImageUrl" required placeholder="https://...">
                </div>
                <div class="form-group form-group-full">
                    <label>Click URL</label>
                    <input type="url" class="form-control" id="adClickUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="adActive">
                        <option value="true">Active</option>
                        <option value="false">Inactive</option>
                    </select>
                </div>
            </div>
            <div style="display:flex;gap:1rem;margin-top:1.5rem;">
                <button type="submit" class="btn btn-primary">Save Ad</button>
                <button type="button" class="btn btn-secondary" onclick="closeAdModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- ========== SETTINGS MODAL ========== -->
<div id="settingModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="settingModalTitle">Add Setting</h2>
            <button class="close-modal" onclick="closeSettingModal()">‚úï</button>
        </div>
        <form id="settingForm">
            <input type="hidden" id="settingId">
            <div class="form-grid">
                <div class="form-group">
                    <label>Key *</label>
                    <input type="text" class="form-control" id="settingKey" placeholder="e.g. site_name" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select class="form-control" id="settingCategory">
                        <option value="general">General</option>
                        <option value="theme">Theme</option>
                        <option value="monetization">Monetization</option>
                        <option value="app">App</option>
                    </select>
                </div>
                <div class="form-group form-group-full">
                    <label>Value *</label>
                    <input type="text" class="form-control" id="settingValue" required placeholder="e.g. ClassicFlims">
                </div>
                <div class="form-group form-group-full">
                    <label>Description</label>
                    <input type="text" class="form-control" id="settingDescription" placeholder="Optional description">
                </div>
            </div>
            <div style="display:flex;gap:1rem;margin-top:1.5rem;">
                <button type="submit" class="btn btn-primary">Save Setting</button>
                <button type="button" class="btn btn-secondary" onclick="closeSettingModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
// ============================================================
// CONFIG
// ============================================================
const API_URL = window.location.hostname === 'localhost'
    ? 'http://localhost:3000/api'
    : `https://streamindia-ott-platform-dgj8.vercel.app/api`;

let authToken = localStorage.getItem('adminToken');
let currentAdmin = null;

// ============================================================
// BOOT
// ============================================================
if (authToken) {
    showPanel();
}

function showPanel() {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('adminPanel').classList.add('active');
    loadDashboard();
}

// ============================================================
// AUTH
// ============================================================
document.getElementById('loginForm').addEventListener('submit', async e => {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    try {
        const res = await fetch(`${API_URL}/admin/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if (res.ok) {
            authToken = data.token;
            currentAdmin = data.admin;
            localStorage.setItem('adminToken', authToken);
            showPanel();
        } else {
            showAlert('loginAlert', data.error || 'Login failed', 'danger');
        }
    } catch (err) {
        showAlert('loginAlert', 'Connection error. Check server is running.', 'danger');
    }
});

document.getElementById('logoutBtn').addEventListener('click', e => {
    e.preventDefault();
    localStorage.removeItem('adminToken');
    location.reload();
});

// ============================================================
// SIDEBAR NAVIGATION
// ============================================================
document.querySelectorAll('.menu-item[data-section]').forEach(item => {
    item.addEventListener('click', e => {
        e.preventDefault();
        const section = item.dataset.section;
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        item.classList.add('active');
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.getElementById(section + 'Section').classList.add('active');
        document.getElementById('pageTitle').textContent = item.querySelector('span:last-child').textContent;
        loadSection(section);
    });
});

function loadSection(section) {
    if (section === 'dashboard') loadDashboard();
    else if (section === 'content') loadContent();
    else if (section === 'navigation') loadNavigation();
    else if (section === 'advertisements') loadAds();
    else if (section === 'settings') loadSettings();
}

// ============================================================
// DASHBOARD
// ============================================================
async function loadDashboard() {
    if (currentAdmin) {
        document.getElementById('adminUsername').textContent = currentAdmin.username;
        document.getElementById('adminAvatar').textContent = currentAdmin.username[0].toUpperCase();
    }
    try {
        const res = await fetch(`${API_URL}/dashboard/stats`, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        const data = await res.json();
        document.getElementById('totalContent').textContent  = data.totalContent  || 0;
        document.getElementById('publishedContent').textContent = data.publishedContent || 0;
        document.getElementById('totalViews').textContent   = (data.totalViews || 0).toLocaleString();
        document.getElementById('totalAds').textContent     = data.totalAds || 0;

        // recent content
        const cRes = await fetch(`${API_URL}/content?limit=5`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        const cData = await cRes.json();
        const tbody = document.getElementById('recentContentTable');
        if (!cData.content || cData.content.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4"><div class="empty-state"><p>No content yet</p></div></td></tr>';
        } else {
            tbody.innerHTML = cData.content.map(c => `
                <tr>
                    <td>${c.title}</td>
                    <td><span class="badge badge-info">${c.type}</span></td>
                    <td>${c.views || 0}</td>
                    <td>${new Date(c.createdAt).toLocaleDateString()}</td>
                </tr>`).join('');
        }
    } catch (err) {
        console.error('Dashboard error:', err);
    }
}

// ============================================================
// CONTENT CRUD
// ============================================================
async function loadContent() {
    document.getElementById('contentTable').innerHTML = '<tr><td colspan="6"><div class="loading"><div class="spinner"></div></div></td></tr>';
    try {
        const res = await fetch(`${API_URL}/content?status=all`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        const data = await res.json();
        const rows = data.content;
        if (!rows || rows.length === 0) {
            document.getElementById('contentTable').innerHTML = '<tr><td colspan="6"><div class="empty-state"><p>No content found. Click + Add Content.</p></div></td></tr>';
            return;
        }
        document.getElementById('contentTable').innerHTML = rows.map(c => `
            <tr>
                <td>${c.title}</td>
                <td><span class="badge badge-info">${c.type}</span></td>
                <td>${c.category || '‚Äî'}</td>
                <td><span class="badge badge-${c.status === 'published' ? 'success' : 'warning'}">${c.status}</span></td>
                <td>${c.views || 0}</td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editContent('${c._id}')">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteContent('${c._id}')">Delete</button>
                </td>
            </tr>`).join('');
    } catch (err) {
        document.getElementById('contentTable').innerHTML = '<tr><td colspan="6" style="color:red;padding:1rem;">Error loading content</td></tr>';
    }
}

function openContentModal(reset = true) {
    if (reset) {
        document.getElementById('contentId').value = '';
        document.getElementById('contentModalTitle').textContent = 'Add Content';
        document.getElementById('contentForm').reset();
    }
    document.getElementById('contentModal').classList.add('active');
}
function closeContentModal() {
    document.getElementById('contentModal').classList.remove('active');
}

async function editContent(id) {
    try {
        const res = await fetch(`${API_URL}/content/${id}`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        const c = await res.json();
        document.getElementById('contentId').value = c._id;
        document.getElementById('contentTitle').value = c.title || '';
        document.getElementById('contentType').value = c.type || 'movie';
        document.getElementById('contentCategory').value = c.category || '';
        document.getElementById('contentLanguage').value = c.language || '';
        document.getElementById('contentYear').value = c.year || '';
        document.getElementById('contentRating').value = c.rating || '';
        document.getElementById('contentDescription').value = c.description || '';
        document.getElementById('contentVideoUrl').value = c.videoUrl || '';
        document.getElementById('contentThumbnail').value = c.thumbnailUrl || '';
        document.getElementById('contentStatus').value = c.status || 'published';
        document.getElementById('contentFeatured').value = c.featured ? 'true' : 'false';
        document.getElementById('contentModalTitle').textContent = 'Edit Content';
        openContentModal(false);
    } catch (err) { showToast('Failed to load content', 'error'); }
}

document.getElementById('contentForm').addEventListener('submit', async e => {
    e.preventDefault();
    const id = document.getElementById('contentId').value;
    const body = {
        title: document.getElementById('contentTitle').value,
        type: document.getElementById('contentType').value,
        category: document.getElementById('contentCategory').value,
        language: document.getElementById('contentLanguage').value,
        year: parseInt(document.getElementById('contentYear').value) || null,
        rating: parseFloat(document.getElementById('contentRating').value) || null,
        description: document.getElementById('contentDescription').value,
        videoUrl: document.getElementById('contentVideoUrl').value,
        thumbnailUrl: document.getElementById('contentThumbnail').value,
        status: document.getElementById('contentStatus').value,
        featured: document.getElementById('contentFeatured').value === 'true'
    };
    try {
        const url   = id ? `${API_URL}/content/${id}` : `${API_URL}/content`;
        const method = id ? 'PUT' : 'POST';
        const res = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
            body: JSON.stringify(body)
        });
        if (res.ok) {
            closeContentModal();
            loadContent();
            showToast(id ? 'Content updated!' : 'Content added!', 'success');
        } else {
            const err = await res.json();
            showToast(err.error || 'Save failed', 'error');
        }
    } catch (err) { showToast('Error saving content', 'error'); }
});

async function deleteContent(id) {
    if (!confirm('Delete this content?')) return;
    try {
        const res = await fetch(`${API_URL}/content/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        if (res.ok) { loadContent(); showToast('Content deleted', 'success'); }
        else showToast('Delete failed', 'error');
    } catch (err) { showToast('Error deleting', 'error'); }
}

// ============================================================
// NAVIGATION CRUD
// ============================================================
async function loadNavigation() {
    document.getElementById('navigationTable').innerHTML = '<tr><td colspan="6"><div class="loading"><div class="spinner"></div></div></td></tr>';
    try {
        const res = await fetch(`${API_URL}/navigation`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        const rows = await res.json();
        if (!rows || rows.length === 0) {
            document.getElementById('navigationTable').innerHTML = '<tr><td colspan="6"><div class="empty-state"><p>No navigation items. Click + Add Menu Item.</p></div></td></tr>';
            return;
        }
        document.getElementById('navigationTable').innerHTML = rows.map(n => `
            <tr>
                <td>${n.label}</td>
                <td>${n.url}</td>
                <td>${n.icon || '‚Äî'}</td>
                <td>${n.order}</td>
                <td><span class="badge badge-${n.active ? 'success' : 'danger'}">${n.active ? 'Active' : 'Inactive'}</span></td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editNav('${n._id}')">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteNav('${n._id}')">Delete</button>
                </td>
            </tr>`).join('');
    } catch (err) {
        document.getElementById('navigationTable').innerHTML = '<tr><td colspan="6" style="color:red;padding:1rem;">Error loading navigation</td></tr>';
    }
}

function openNavModal(reset = true) {
    if (reset) {
        document.getElementById('navId').value = '';
        document.getElementById('navModalTitle').textContent = 'Add Menu Item';
        document.getElementById('navForm').reset();
        document.getElementById('navActive').value = 'true';
    }
    document.getElementById('navModal').classList.add('active');
}
function closeNavModal() { document.getElementById('navModal').classList.remove('active'); }

async function editNav(id) {
    try {
        const res = await fetch(`${API_URL}/navigation`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        const rows = await res.json();
        const n = rows.find(r => r._id === id);
        if (!n) { showToast('Item not found', 'error'); return; }
        document.getElementById('navId').value = n._id;
        document.getElementById('navLabel').value = n.label || '';
        document.getElementById('navUrl').value = n.url || '';
        document.getElementById('navIcon').value = n.icon || '';
        document.getElementById('navOrder').value = n.order || 0;
        document.getElementById('navActive').value = n.active ? 'true' : 'false';
        document.getElementById('navModalTitle').textContent = 'Edit Menu Item';
        openNavModal(false);
    } catch (err) { showToast('Failed to load item', 'error'); }
}

document.getElementById('navForm').addEventListener('submit', async e => {
    e.preventDefault();
    const id = document.getElementById('navId').value;
    const body = {
        label: document.getElementById('navLabel').value,
        url: document.getElementById('navUrl').value,
        icon: document.getElementById('navIcon').value,
        order: parseInt(document.getElementById('navOrder').value) || 0,
        active: document.getElementById('navActive').value === 'true'
    };
    try {
        const url    = id ? `${API_URL}/navigation/${id}` : `${API_URL}/navigation`;
        const method = id ? 'PUT' : 'POST';
        const res = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
            body: JSON.stringify(body)
        });
        if (res.ok) {
            closeNavModal();
            loadNavigation();
            showToast(id ? 'Navigation updated!' : 'Navigation added!', 'success');
        } else {
            const err = await res.json();
            showToast(err.error || 'Save failed', 'error');
        }
    } catch (err) { showToast('Error saving navigation', 'error'); }
});

async function deleteNav(id) {
    if (!confirm('Delete this navigation item?')) return;
    try {
        const res = await fetch(`${API_URL}/navigation/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        if (res.ok) { loadNavigation(); showToast('Navigation deleted', 'success'); }
        else showToast('Delete failed', 'error');
    } catch (err) { showToast('Error deleting', 'error'); }
}

// ============================================================
// ADVERTISEMENTS CRUD
// ============================================================
async function loadAds() {
    document.getElementById('adsTable').innerHTML = '<tr><td colspan="6"><div class="loading"><div class="spinner"></div></div></td></tr>';
    try {
        const res = await fetch(`${API_URL}/advertisements`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        const rows = await res.json();
        if (!rows || rows.length === 0) {
            document.getElementById('adsTable').innerHTML = '<tr><td colspan="6"><div class="empty-state"><p>No ads found. Click + Add Advertisement.</p></div></td></tr>';
            return;
        }
        document.getElementById('adsTable').innerHTML = rows.map(a => `
            <tr>
                <td>${a.title}</td>
                <td><span class="badge badge-info">${a.type}</span></td>
                <td>${a.position}</td>
                <td>${a.priority}</td>
                <td><span class="badge badge-${a.active ? 'success' : 'danger'}">${a.active ? 'Active' : 'Inactive'}</span></td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editAd('${a._id}')">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteAd('${a._id}')">Delete</button>
                </td>
            </tr>`).join('');
    } catch (err) {
        document.getElementById('adsTable').innerHTML = '<tr><td colspan="6" style="color:red;padding:1rem;">Error loading ads</td></tr>';
    }
}

function openAdModal(reset = true) {
    if (reset) {
        document.getElementById('adId').value = '';
        document.getElementById('adModalTitle').textContent = 'Add Advertisement';
        document.getElementById('adForm').reset();
        document.getElementById('adPriority').value = '5';
        document.getElementById('adActive').value = 'true';
    }
    document.getElementById('adModal').classList.add('active');
}
function closeAdModal() { document.getElementById('adModal').classList.remove('active'); }

async function editAd(id) {
    try {
        const res = await fetch(`${API_URL}/advertisements`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        const rows = await res.json();
        const a = rows.find(r => r._id === id);
        if (!a) { showToast('Ad not found', 'error'); return; }
        document.getElementById('adId').value = a._id;
        document.getElementById('adTitle').value = a.title || '';
        document.getElementById('adType').value = a.type || 'banner';
        document.getElementById('adPosition').value = a.position || 'header';
        document.getElementById('adPriority').value = a.priority || 5;
        document.getElementById('adImageUrl').value = a.imageUrl || '';
        document.getElementById('adClickUrl').value = a.clickUrl || '';
        document.getElementById('adActive').value = a.active ? 'true' : 'false';
        document.getElementById('adModalTitle').textContent = 'Edit Advertisement';
        openAdModal(false);
    } catch (err) { showToast('Failed to load ad', 'error'); }
}

document.getElementById('adForm').addEventListener('submit', async e => {
    e.preventDefault();
    const id = document.getElementById('adId').value;
    const body = {
        title: document.getElementById('adTitle').value,
        type: document.getElementById('adType').value,
        position: document.getElementById('adPosition').value,
        priority: parseInt(document.getElementById('adPriority').value) || 5,
        imageUrl: document.getElementById('adImageUrl').value,
        clickUrl: document.getElementById('adClickUrl').value,
        active: document.getElementById('adActive').value === 'true'
    };
    try {
        const url    = id ? `${API_URL}/advertisements/${id}` : `${API_URL}/advertisements`;
        const method = id ? 'PUT' : 'POST';
        const res = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
            body: JSON.stringify(body)
        });
        if (res.ok) {
            closeAdModal();
            loadAds();
            showToast(id ? 'Ad updated!' : 'Ad added!', 'success');
        } else {
            const err = await res.json();
            showToast(err.error || 'Save failed', 'error');
        }
    } catch (err) { showToast('Error saving ad', 'error'); }
});

async function deleteAd(id) {
    if (!confirm('Delete this advertisement?')) return;
    try {
        const res = await fetch(`${API_URL}/advertisements/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        if (res.ok) { loadAds(); showToast('Ad deleted', 'success'); }
        else showToast('Delete failed', 'error');
    } catch (err) { showToast('Error deleting', 'error'); }
}

// ============================================================
// SETTINGS CRUD
// ============================================================
async function loadSettings() {
    document.getElementById('settingsTable').innerHTML = '<tr><td colspan="4"><div class="loading"><div class="spinner"></div></div></td></tr>';
    try {
        const res = await fetch(`${API_URL}/settings`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        const rows = await res.json();
        if (!rows || rows.length === 0) {
            document.getElementById('settingsTable').innerHTML = '<tr><td colspan="4"><div class="empty-state"><p>No settings found. Click + Add Setting.</p></div></td></tr>';
            return;
        }
        document.getElementById('settingsTable').innerHTML = rows.map(s => `
            <tr>
                <td><strong>${s.key}</strong></td>
                <td>${String(s.value)}</td>
                <td><span class="badge badge-info">${s.category || 'general'}</span></td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editSetting('${s._id}', '${s.key}', \`${String(s.value).replace(/`/g,"'")}\`, '${s.category || 'general'}', '${(s.description || '').replace(/'/g,"\\'")}')">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteSetting('${s._id}')">Delete</button>
                </td>
            </tr>`).join('');
    } catch (err) {
        document.getElementById('settingsTable').innerHTML = '<tr><td colspan="4" style="color:red;padding:1rem;">Error loading settings</td></tr>';
    }
}

function openSettingModal(reset = true) {
    if (reset) {
        document.getElementById('settingId').value = '';
        document.getElementById('settingModalTitle').textContent = 'Add Setting';
        document.getElementById('settingForm').reset();
    }
    document.getElementById('settingModal').classList.add('active');
}
function closeSettingModal() { document.getElementById('settingModal').classList.remove('active'); }

function editSetting(id, key, value, category, description) {
    document.getElementById('settingId').value = id;
    document.getElementById('settingKey').value = key;
    document.getElementById('settingValue').value = value;
    document.getElementById('settingCategory').value = category;
    document.getElementById('settingDescription').value = description;
    document.getElementById('settingModalTitle').textContent = 'Edit Setting';
    openSettingModal(false);
}

document.getElementById('settingForm').addEventListener('submit', async e => {
    e.preventDefault();
    const id = document.getElementById('settingId').value;
    const body = {
        key: document.getElementById('settingKey').value,
        value: document.getElementById('settingValue').value,
        category: document.getElementById('settingCategory').value,
        description: document.getElementById('settingDescription').value
    };
    try {
        const url    = id ? `${API_URL}/settings/${id}` : `${API_URL}/settings`;
        const method = id ? 'PUT' : 'POST';
        const res = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
            body: JSON.stringify(body)
        });
        if (res.ok) {
            closeSettingModal();
            loadSettings();
            showToast(id ? 'Setting updated!' : 'Setting added!', 'success');
        } else {
            const err = await res.json();
            showToast(err.error || 'Save failed', 'error');
        }
    } catch (err) { showToast('Error saving setting', 'error'); }
});

async function deleteSetting(id) {
    if (!confirm('Delete this setting?')) return;
    try {
        const res = await fetch(`${API_URL}/settings/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        if (res.ok) { loadSettings(); showToast('Setting deleted', 'success'); }
        else showToast('Delete failed', 'error');
    } catch (err) { showToast('Error deleting', 'error'); }
}

// ============================================================
// HELPERS
// ============================================================
function showAlert(elId, msg, type) {
    const el = document.getElementById(elId);
    el.className = `alert alert-${type}`;
    el.textContent = msg;
    el.style.display = 'block';
    setTimeout(() => { el.style.display = 'none'; }, 5000);
}

function showToast(msg, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = msg;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// Close modals on backdrop click
document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', e => {
        if (e.target === modal) modal.classList.remove('active');
    });
});
</script>
</body>
</html>
